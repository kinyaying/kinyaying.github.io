---
title: å¿«é€Ÿä¸Šæ‰‹æ²¹çŒ´æ’ä»¶å¼€å‘ï¼ˆå®æˆ˜ç¯‡ï¼‰
date: 2021-02-09 13:58:06
tags: node
keywords:
  - æµè§ˆå™¨æ’ä»¶
  - æ²¹çŒ´æ’ä»¶
---

è¿™ç¯‡æ–‡ç« ä½ èƒ½å¤Ÿå­¦ä¹ åˆ°ï¼š

1. å¿«é€Ÿä½¿ç”¨æ²¹çŒ´æ’ä»¶è¿›è¡Œæµè§ˆå™¨æ’ä»¶å¼€å‘
2. ç”¨ wokoo è„šæ‰‹æ¶å¼€å‘ 2 ä¸ªæœ‰æ„æ€çš„æ’ä»¶: åˆ’è¯æœç´¢[MoveSearch](https://greasyfork.org/zh-CN/scripts/421189-movesearch) å’Œ çŸ¥ä¹ç›®å½•[zhihu-helper](https://greasyfork.org/zh-CN/scripts/421238-zhihu-helper)
3. æœ‰ç²¾åŠ›çš„è¯å¯ä»¥ç»§ç»­å­¦ä¹ [wokoo è„šæ‰‹æ¶çš„æ­å»º](<https://gitee.com/zhufengpeixun/browser-plugin/blob/master/wokoo%E8%84%9A%E6%89%8B%E6%9E%B6(%E6%90%AD%E5%BB%BA%E7%AF%87).md>)ã€‚

<!-- more -->

# ä¸ºä»€ä¹ˆè¦å­¦ä¹ æµè§ˆå™¨æ’ä»¶å¼€å‘

æµè§ˆå™¨æ’ä»¶å¼€å‘æœ‰çš„åŒå­¦å¯èƒ½æ¥è§¦çš„ä¸å¤šï¼Œæˆ–è€…æœ‰ç–‘é—®ï¼Œå­¦ä¹ å¼€å‘æµè§ˆå™¨æ’ä»¶æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿè¿™é‡Œæˆ‘åˆ—ä¸¾ä¸€äº›å·¥ä½œä¸­çš„åœºæ™¯ï¼š

**åœºæ™¯ 1ï¼š**

å‘Šè­¦å¹³å°æ”¶åˆ°æŸä¸ªå‰ç«¯é¡¹ç›®çš„å‘Šè­¦æ—¥å¿—ï¼Œä¸ºäº†å¤ç°å®šä½é—®é¢˜ï¼Œéœ€è¦ç™»å½•æŸä¸ªè´¦å·å†…è¿›è¡ŒæŸ¥çœ‹ã€‚æ­¤æ—¶ rd éœ€è¦è”ç³»äº§å“åŒå­¦ï¼Œè®©äº§å“åŒå­¦è”ç³»å¯¹åº”çš„ç”¨æˆ·ï¼Œè®©ç”¨æˆ·æä¾›è´¦å·å¯†ç ç»™ rdã€‚æ­¤æµç¨‹å¾ˆé•¿ï¼Œè€Œä¸”ç»™ç”¨æˆ·é€ æˆä¸å¥½çš„å°è±¡ã€‚è€Œå¦‚æœå…¬å¸å†…éƒ¨æ”¯æŒå…å¯†ç™»å½•ï¼Œåªæ˜¯éœ€è¦æ‹¼æ¥ä¸€ä¸ªç‰¹å®šçš„ urlï¼Œurl è§„åˆ™æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦æœ‰è´¦å· id ç­‰ä¿¡æ¯ã€‚æ­¤æ—¶å¦‚æœå°†æ‹¼æ¥è§„åˆ™å†™åˆ°æ’ä»¶é‡Œï¼Œæ’ä»¶æä¾›ä¸€ä¸ªæŒ‰é’®å°±èƒ½å¤Ÿè·³è½¬åˆ°å¯¹åº”çš„ç”¨æˆ·è´¦å·ä¸­ï¼Œæ˜¯ä¸æ˜¯é™ä½äº† rd çš„å·¥ä½œé‡ï¼Ÿ

**åœºæ™¯ 2ï¼š**

å½“æµ‹è¯•çš„åŒå­¦å‘ç°é—®é¢˜æ—¶ï¼Œéœ€è¦æˆªå›¾ï¼Œæ‰“å¼€æµ‹è¯•å¹³å°ï¼Œå¡«å†™å…·ä½“çš„é—®é¢˜ï¼Œæäº¤æµ‹è¯•æŠ¥å‘Šã€‚å¦‚æœèƒ½æœ‰æ’ä»¶åœ¨å½“å‰é¡µé¢ä¸­å¼¹å‡ºè¦å¡«å†™çš„æµ‹è¯•è¡¨å•ï¼Œæ˜¯ä¸æ˜¯å°±å‡å°‘äº†æµ‹è¯•åŒå­¦çš„å·¥ä½œæµç¨‹ï¼Ÿ

**å­¦ä¼šäº†æµè§ˆå™¨æ’ä»¶å¼€å‘åï¼Œå¯ä»¥åšä¸€äº›å·¥ä½œåœºæ™¯ç›¸å…³çš„æ’ä»¶ï¼Œæ¥å¸®åŠ©è‡ªå·±ä»¥åŠåŒäº‹æé«˜æ•ˆç‡ã€‚è¿™ä¸ç®¡æ˜¯è¿°èŒæ™‹å‡è¿˜æ˜¯è·³æ§½æ¢å·¥ä½œéƒ½ä¼šæ˜¯ä¸€ä¸ªåŠ åˆ†çš„äº®ç‚¹ã€‚**

# æ­£å¼å¼€å§‹æ’ä»¶å¼€å‘

## ä¸€ã€åˆ’è¯æœç´¢ MoveSearch

### **æˆå“å±•ç¤º**

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4945d70b45d9414a9f7c248c90962d41~tplv-k3u1fbpfcp-watermark.image)

å®‰è£…åœ°å€ï¼š

1. å®‰è£…[æ²¹çŒ´æ’ä»¶](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?hl=zh-CN)
2. å®‰è£…[MoveSearch](https://greasyfork.org/zh-CN/scripts/421189-movesearch)

ä»£ç åœ°å€ï¼š[wokoo/example/MoveSearch](https://github.com/kinyaying/wokoo/tree/master/example/MoveSearch)

### å¼€å‘æ­¥éª¤

### 1.1 é¡¹ç›®å®‰è£… & åˆå§‹åŒ–é…ç½®

```shell
npm i wokoo -g
wokoo MoveSearch
```

é€‰æ‹©æ¨¡æ¿

- [ ] vue
- [ ] react

è¿™é‡Œé€‰æ‹© react

å®‰è£…å®Œæˆåï¼Œå‡ºç°å®‰è£…æˆåŠŸçš„ç•Œé¢

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5746c0132f64f93b60a4645b7bb20c0~tplv-k3u1fbpfcp-watermark.image)

æ ¹æ®æç¤ºæ‰§è¡Œä¸‹å‘½ä»¤

```shell
cd MoveSearch
npm start
```

- æ‰“å¼€æ²¹çŒ´è„šæœ¬ç¼–è¾‘å™¨ï¼ŒæŠŠ tampermonkey.js çš„å†…å®¹å¤åˆ¶è¿›å»ã€‚ï¼ˆæ³¨æ„ï¼šè¿™é‡Œæ˜¯æŒ‡æŠŠ tampermonkey.js é‡Œçš„æ‰€æœ‰å†…å®¹éƒ½å¤åˆ¶è¿›å»ï¼ŒåŒ…æ‹¬æ³¨é‡Šã€‚å› ä¸ºæ­¤æ–‡ä»¶ä¸­è¢«æ³¨é‡Šæ‰çš„//@xxx éƒ½æœ‰å«ä¹‰ï¼Œå¯ä»¥å¯¹åº”ç€ [tampermonkey å¼€å‘æ–‡æ¡£ ](https://www.tampermonkey.net/documentation.php?version=4.6&ext=dhdg) ç†è§£ã€‚æ¯”å¦‚`@match https://`ä»£è¡¨åœ¨ https é¡µé¢ä¸‹æ‰ä¼šå¯åŠ¨æ’ä»¶ï¼‰

  ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/00816864079341c191e3fd68512098d8~tplv-k3u1fbpfcp-watermark.image)
  ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9869211b77f645518f7e1d3ea7a1b908~tplv-k3u1fbpfcp-watermark.image)

- æ‰“å¼€ç½‘é¡µ[å¼€å‘è€…æœç´¢](https://kaifa.baidu.com/searchPage?wd=%E6%B2%B9%E7%8C%B4%E6%8F%92%E4%BB%B6)ï¼Œå³ä¸Šè§’å‡ºç°çŒ´å­çš„ logoï¼Œè¯´æ˜ç¯å¢ƒè·‘é€š

### 1.2 å®ç°åŸºæœ¬åŠŸèƒ½

å…ˆæ•´ç†ä¸€ä¸‹æ€è·¯ï¼Œè¦å®ç°åˆ’è¯æœç´¢åŠŸèƒ½ï¼Œä¸»è¦å®ç°ä»¥ä¸‹æ­¥éª¤ï¼š

1. ç›‘å¬ mouseup äº‹ä»¶ï¼Œè§¦å‘æ—¶æ£€æŸ¥æ˜¯å¦æœ‰æ–‡å­—è¢«é€‰ä¸­ï¼Œå¦‚æœæœ‰åˆ™å¼¹çª—å±•ç¤º
2. å¼¹çª—å±•ç¤ºå‰å‘è¯·æ±‚åˆ° baidu çš„[å¼€å‘è€…æœç´¢](https://kaifa.baidu.com/rest/v1/search?query=html&pageNum=1&pageSize=10)çš„æ¥å£ï¼Œè·å–æœç´¢å†…å®¹
3. å¦‚æœæœç´¢å†…å®¹ä¸ä¸ºç©ºï¼Œå°†å†…å®¹å±•ç¤ºåˆ°å¼¹çª—ä¸­
4. è¾¹ç•Œæ£€æµ‹ï¼Œç‚¹å‡»å¼¹çª—åŒºåŸŸå¤–çš„å†…å®¹ï¼Œå¼¹çª—å…³é—­

æ­¤å¤„æœ‰ä¸ªéš¾ç‚¹ï¼Œå°±æ˜¯ baidu çš„[å¼€å‘è€…æœç´¢](https://kaifa.baidu.com/searchPage)æ¥å£ä¸å…è®¸è·¨åŸŸï¼Œæ¯”å¦‚åœ¨æ˜é‡‘çš„ç½‘é¡µä¸­å»è¯·æ±‚[å¼€å‘è€…æœç´¢](https://kaifa.baidu.com/rest/v1/search?query=html&pageNum=1&pageSize=10)çš„æ¥å£ä¼šè¢«æ‹¦ä½ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä½¿ç”¨[vercel](https://vercel.com/dashboard)æä¾›çš„ serverless æœåŠ¡åšäº†ä¸€æ¬¡ä»£ç†ï¼Œåœ¨ä»£ç†ä¸­ç»™å“åº”å¤´å¢åŠ äº†`Access-Control-Allow-Origin`ç­‰å­—æ®µï¼Œå¼€å¯è·¨åŸŸã€‚å…·ä½“æ–¹æ³•åœ¨**1.3**ç»™å‡ºï¼Œæ­¤æ—¶æˆ‘ä»¬å…ˆåœ¨[å¼€å‘è€…æœç´¢](https://kaifa.baidu.com/searchPage)é¡µé¢é‡Œé¢è¿›è¡Œå¼€å‘ï¼Œå…ˆä¿è¯æ˜¯åŒåŸŸä¸‹ã€‚

**æ­¥éª¤ 1. ç›‘å¬ mouseup äº‹ä»¶ï¼Œè§¦å‘æ—¶æ£€æŸ¥æ˜¯å¦æœ‰æ–‡å­—è¢«é€‰ä¸­**

ç¼–è¾‘`/src/app.js`æ–‡ä»¶ï¼Œå¢åŠ å¯¹ mouseup çš„ç›‘å¬ï¼š

```js
import React from 'react'
import axios from 'axios'
import './app.less'

export default class extends React.Component {
  constructor(props) {
    super(props)
    this.state = { show: false }
  }
  componentDidMount() {
    document.addEventListener('mouseup', (e) => {
      var selectionObj = window.getSelection()
      var selectedText = selectionObj.toString()
      console.log('selectedText', selectedText)
    })
  }

  render() {
    let { show } = this.state
    return <>{show ? <div className="Wokoo"></div> : null}</>
  }
}
```

**æ­¥éª¤ 2. å¼¹çª—å±•ç¤ºå‰å‘è¯·æ±‚åˆ°[å¼€å‘è€…æœç´¢](https://kaifa.baidu.com/rest/v1/search?query=html&pageNum=1&pageSize=10)çš„æ¥å£ï¼Œè·å–æœç´¢å†…å®¹**

- å®‰è£… axiosï¼Œå¼•å…¥ axios
- å¯¹ componentDidMount å†…çš„ä»£ç è¿›è¡Œæ”¹é€ ï¼Œè¯·æ±‚[å¼€å‘è€…æœç´¢](https://kaifa.baidu.com/rest/v1/search?query=html&pageNum=1&pageSize=10) è·å–æœç´¢ç»“æœ

```js
componentDidMount() {
    document.addEventListener('mouseup', (e) => {
      var selectionObj = window.getSelection()
      var selectedText = selectionObj.toString()
      console.log('selectionObj::', selectedText)
      if (selectedText.length === 0) {
      } else {
        axios
          .get(
            `https://kaifa.baidu.com/rest/v1/search?query=${selectedText}&pageNum=1&pageSize=10`
          )
          .then((res) => {
            let { data } = res.data.data.documents
            console.log(data)
            if (data.length) {
              this.setState({
                data: data,
                show: true,
              })
            }
          })
      }
    })
  }
```

- ä¿®æ”¹ renderï¼Œå±•ç¤ºæœç´¢ç»“æœ

```js
render() {
    let { show, data } = this.state
    return (
      <>
        {show ? (
          <div className="Wokoo">
            <ul>
              {data.map((i) => (
                <li>{i.title}</li>
              ))}
            </ul>
          </div>
        ) : null}
      </>
    )
  }
```

æ­¤æ—¶ï¼Œç½‘é¡µä¸­èƒ½å¤Ÿçœ‹åˆ°æœç´¢çš„ç»“æœäº†ï¼ŒåŸºæœ¬åŠŸèƒ½æå®šäº†ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7836c1fdf15242f98efe616b11ef3e05~tplv-k3u1fbpfcp-watermark.image)

**æ­¥éª¤ 3. è®¡ç®—å¼¹çª—å‡ºç°çš„ä½ç½®ï¼Œè®©å¼¹çª—å‡ºç°åœ¨é€‰ä¸­æ–‡å­—ä¸‹æ–¹**

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68e92522fb8d45f194915a24c114ad32~tplv-k3u1fbpfcp-watermark.image)
![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e84a26dfb614484b180be34fd49cb7a~tplv-k3u1fbpfcp-watermark.image)

æˆ‘ä»¬å¯ä»¥å¾—å‡ºè®¡ç®—å…¬å¼ä¸ºï¼š

> left = x + width/2 - MODAL_WIDTH/2
>
> top = y + height

æ­¤æ—¶ï¼Œ`app.js`çš„ä»£ç è¢«æ”¹é€ æˆè¿™æ ·ï¼š

```js
import React from 'react'
import axios from 'axios'
import './app.less'
const MODAL_WIDTH = 350
export default class extends React.Component {
  constructor(props) {
    super(props)
    this.state = { show: false, data: [] }
  }
  componentDidMount() {
    document.addEventListener('mouseup', (e) => {
      var selectionObj = window.getSelection()
      var selectedText = selectionObj.toString()
      if (selectedText.length === 0) {
      } else {
        var selectionObjRect = selectionObj
          .getRangeAt(0)
          .getBoundingClientRect()
        let { x, y, height, width } = selectionObjRect // è·å–é€‰ä¸­æ–‡å­—çš„ä½ç½®ï¼Œx yæ˜¯æ¨ªçºµåæ ‡ï¼Œheight widthæ˜¯é€‰ä¸­æ–‡å­—çš„é«˜åº¦å’Œå®½åº¦
        // è®¡ç®—å¼¹çª—ä½ç½®ï¼Œç®—å‡ºleftå’Œtop
        var left = x - MODAL_WIDTH / 2 + width / 2
        left = left > 10 ? left : 10
        var top = y + height
        var scrollLeft =
          document.documentElement.scrollLeft || document.body.scrollLeft
        var scrollTop =
          document.documentElement.scrollTop || document.body.scrollTop
        axios
          .get(
            `https://kaifa.baidu.com/rest/v1/search?query=${selectedText}&pageNum=1&pageSize=10`
          )
          .then((res) => {
            let { data } = res.data.data.documents
            if (data.length) {
              this.setState({
                data,
                show: true,
                selectedText: selectedText,
                modalPosition: {
                  left: left + scrollLeft,
                  top: top + scrollTop,
                },
              })
            }
          })
      }
    })
  }

  render() {
    let { show, selectedText, modalPosition, data } = this.state
    return (
      <>
        {show && data && data.length ? (
          <div
            className="move-search"
            id="MoveSearchApp"
            style={{
              ...modalPosition,
            }}
          >
            <div className="move-search-content">
              <ul className="move-search-ul">
                {data.map((l) => (
                  <li className="move-search-li" key={l.id}>
                    <a href={l.url} target="_blank">
                      {l.title}
                    </a>
                    <span>{l.summary}</span>
                  </li>
                ))}
              </ul>
            </div>
            <div className="move-search-bottom-fade"></div>
            <footer className="move-search-footer">
              <a
                href={`https://kaifa.baidu.com/searchPage?wd=${selectedText}`}
                target="_blank"
              >
                Read More
              </a>
            </footer>
          </div>
        ) : null}
      </>
    )
  }
}
```

åˆ«å¿˜äº†å¢åŠ æ ·å¼ï¼Œä¿®æ”¹ app.less

```css
.move-search {
  position: absolute;
  text-align: center;
  width: 350px;
  max-height: 300px;
  top: 0;
  right: 0;
  border-radius: 5px;
  z-index: 2147483647;
  box-shadow: rgba(0, 0, 0, 0.2) 0px 16px 100px 0px;
  transition: all 0.1s ease-out 0s;
  border: 1px solide #282a33;
  background: #fff;
  font-size: 12px;
  overflow: scroll;
  text-align: left;
}
```

**æ­¥éª¤ 4. è¾¹ç•Œæ£€æµ‹ï¼Œç‚¹å‡»å¼¹çª—å¤–éƒ¨ï¼Œå¼¹çª—éšè—**

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/56e7d842346e496bb864c206da741c9e~tplv-k3u1fbpfcp-watermark.image)

è¾¹ç•Œæ£€æµ‹çš„åˆ¤æ–­æ¡ä»¶å¦‚ä¸‹ï¼š

> left+width > x > left && top+height > y > top

```js
function boundaryDetection(x, y, modalPosition = { left: 0, top: 0 }) {
  let { left, top } = modalPosition
  if (
    x > left &&
    x < left + MODAL_WIDTH &&
    y > top &&
    y < top + MoveSearchApp.offsetHeight
  ) {
    return true
  }
  return false
}
```

ä¿®æ”¹`app.js`å¢åŠ å¼¹çª—æ¶ˆå¤±çš„é€»è¾‘ï¼Œåœ¨ selectedText ä¸ºç©ºæ—¶åˆ¤æ–­é¼ æ ‡ä½ç½®æ˜¯å¦åœ¨å¼¹çª—å†…ã€‚

```js
import React from 'react'
import axios from 'axios'
import './app.less'
// å¼¹çª—å®½åº¦
const MODAL_WIDTH = 350
/**
 * è¾¹ç•Œæ£€æµ‹ï¼Œé¼ æ ‡ç‚¹å‡»modalä¹‹å¤–ï¼Œmodaléšè—
 * @param {*} x é¼ æ ‡çš„xè½´ä½ç½®
 * @param {*} y é¼ æ ‡çš„yè½´ä½ç½®
 * @param {*} modalPosition å¼¹çª—çš„leftå’Œtop
 */
function boundaryDetection(x, y, modalPosition = { left: 0, top: 0 }) {
  let { left, top } = modalPosition
  if (
    x > left &&
    x < left + MODAL_WIDTH &&
    y > top &&
    y < top + MoveSearchApp.offsetHeight
  ) {
    return true
  }
  return false
}
export default class extends React.Component {
  constructor(props) {
    super(props)
    this.state = { show: false, data: [] }
  }
  componentDidMount() {
    document.addEventListener('mouseup', (e) => {
      var selectionObj = window.getSelection()
      var selectedText = selectionObj.toString()
      if (selectedText.length === 0) {
        if (this.state.show) {
          // é‡æ–°è®¡ç®—æ˜¯å¦å…³é—­å¼¹çª—
          // æ£€æµ‹é¼ æ ‡ä½ç½®æ˜¯å¦åœ¨å¼¹çª—å†…ï¼Œä¸æ˜¯åˆ™å…³é—­å¼¹çª—
          var inModal = boundaryDetection(
            e.clientX,
            e.clientY,
            this.state.modalPosition
          )
          if (!inModal) {
            this.setState({
              show: false,
              data: [],
            })
          }
        }
      } else {
        var selectionObjRect = selectionObj
          .getRangeAt(0)
          .getBoundingClientRect()
        let { x, y, height, width } = selectionObjRect // è·å–é€‰ä¸­æ–‡å­—çš„ä½ç½®ï¼Œx yæ˜¯æ¨ªçºµåæ ‡ï¼Œheight widthæ˜¯é€‰ä¸­æ–‡å­—çš„é«˜åº¦å’Œå®½åº¦
        // è®¡ç®—å¼¹çª—ä½ç½®ï¼Œç®—å‡ºleftå’Œtop
        var left = x - MODAL_WIDTH / 2 + width / 2
        left = left > 10 ? left : 10
        var top = y + height
        var scrollLeft =
          document.documentElement.scrollLeft || document.body.scrollLeft
        var scrollTop =
          document.documentElement.scrollTop || document.body.scrollTop
        axios
          .get(
            `https://kaifa.baidu.com/rest/v1/search?query=${selectedText}&pageNum=1&pageSize=10`
          )
          .then((res) => {
            let { data } = res.data.data.documents
            if (data.length) {
              this.setState({
                data,
                show: true,
                selectedText: selectedText,
                modalPosition: {
                  left: left + scrollLeft,
                  top: top + scrollTop,
                },
              })
            }
          })
      }
    })
  }

  render() {
    let { show, selectedText, modalPosition, data } = this.state
    return (
      <>
        {show && data && data.length ? (
          <div
            className="move-search"
            id="MoveSearchApp"
            style={{
              ...modalPosition,
            }}
          >
            <div className="move-search-content">
              <ul className="move-search-ul">
                {data.map((l) => (
                  <li className="move-search-li" key={l.id}>
                    <a href={l.url} target="_blank">
                      {l.title}
                    </a>
                    <span>{l.summary}</span>
                  </li>
                ))}
              </ul>
            </div>
            <div className="move-search-bottom-fade"></div>
            <footer className="move-search-footer">
              <a
                href={`https://kaifa.baidu.com/searchPage?wd=${selectedText}`}
                target="_blank"
              >
                Read More
              </a>
            </footer>
          </div>
        ) : null}
      </>
    )
  }
}
```

æ­¤æ—¶ï¼Œé¡¹ç›®çš„åŸºæœ¬åŠŸèƒ½å·²ç»å¼€å‘å®Œæˆ ğŸ‰ï¼Œä¸€äº›æ ·å¼é—®é¢˜å¯ä»¥è‡ªè¡Œè°ƒæ•´ã€‚

å…·ä½“çš„ä»£ç é€»è¾‘å¯çœ‹ github åœ°å€ï¼š[MoveSearch](https://github.com/kinyaying/wokoo/tree/master/example/MoveSearch)

### 1.3 è§£å†³è·¨åŸŸé—®é¢˜

ç™¾åº¦çš„æ¥å£ä¸å…è®¸è·¨åŸŸè®¿é—®ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬åœ¨ä¸€ä¸ªç¬¬ä¸‰æ–¹é¡µé¢ï¼Œæ¯”å¦‚ cdnï¼Œæ˜é‡‘ç­‰çš„ç½‘é¡µé‡Œï¼Œè¦è®¿é—®ç™¾åº¦çš„æ¥å£å°±å­˜åœ¨è·¨åŸŸé™åˆ¶ï¼Œæ²¡æ³•è®¿é—®ã€‚æˆ‘é‡‡ç”¨å¢åŠ  node ä¸­é—´å±‚ï¼Œåœ¨ node ä¸­ç»™å“åº”å¢åŠ `Access-Control-Allow-Origin`è¯·æ±‚å¤´çš„æ–¹å¼å¼€å¯è·¨åŸŸã€‚

ç›®å‰æœ‰ç°æˆçš„æä¾› serverless æœåŠ¡çš„ç¬¬ä¸‰æ–¹å‚å®¶ï¼Œæä¾›æœåŠ¡å™¨ï¼Œnode ç¯å¢ƒç­‰æœåŠ¡ï¼Œæˆ‘ä»¬åªè¦å…³å¿ƒ node çš„ä»£ç é€»è¾‘å³å¯ï¼Œéƒ¨ç½²æœåŠ¡å™¨é…ç½®ç¯å¢ƒç­‰é—®é¢˜äº¤ç»™ç¬¬ä¸‰æ–¹å‚å®¶è§£å†³ã€‚æˆ‘é‡‡ç”¨[vercel](https://vercel.com/dashboard)æä¾›çš„æœåŠ¡ã€‚

ä¸‹é¢çš„å†…å®¹å’Œæ’ä»¶å¼€å‘å…³ç³»ä¸å¤§ï¼Œå¦‚æœä¸æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ç›´æ¥ä½¿ç”¨æˆ‘é…ç½®å¥½çš„åŸŸåï¼š`https:/movesearch.vercel.app/api/baidu`ã€‚
ä¹Ÿå°±æ˜¯å°†ä»£ç ä¸­ axios è¯·æ±‚çš„ url ç”±

```
`https://kaifa.baidu.com/rest/v1/search?query=${selectedText}&pageNum=1&pageSize=10`
```

æ›¿æ¢æˆ

```
`https://movesearch.vercel.app/api/baidu?query=${selectedText}&pageNum=1&pageSize=10`
```

å¦‚æœå¯¹äºå¦‚ä½•å®ç°è·¨åŸŸé…ç½®æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹ ğŸ‘‡ã€‚

1. ç™»å½•[vercel](https://vercel.com/dashboard)å®˜ç½‘ï¼Œæ ¹æ®æç¤ºç»‘å®š github è´¦å·ï¼›
2. ç‚¹å‡»æ–°å»º next é¡¹ç›®ã€‚vercel ä¼šè‡ªåŠ¨ç»™ä½ çš„ github ä¸Šåˆ›å»ºæ–°çš„ä»“åº“ï¼Œå¹¶æœ‰ä¸€ä¸ªåˆå§‹åŒ–é¡¹ç›®ï¼›ï¼ˆæ³¨æ„ï¼šæ­¤å¤„ä¼šè®©ä½ å¡«å†™ä»“åº“åï¼Œæ­¤ä»“åº“åå’ŒåŸŸåæ˜¯ç›¸å…³è”çš„ã€‚ï¼‰
3. git clone æ­¤é¡¹ç›®åˆ°æœ¬åœ°ï¼Œæ ¹æ® readme çš„æç¤ºï¼Œæ‰§è¡Œ`npm run dev`ï¼Œå¯åŠ¨é¡¹ç›®
4. å¢åŠ `src/api/baidu.js`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œ`src/api/baidu.js`ä¸‹çš„æ–‡ä»¶å¯¹åº”çš„å°±æ˜¯`/api/baidu`æ¥å£

```js
const { createProxyMiddleware } = require('http-proxy-middleware')

// restream parsed body before proxying
var restream = function (proxyRes, req, res, options) {
  proxyRes.headers['Access-Control-Allow-Origin'] = '*'
  proxyRes.headers['Access-Control-Allow-Headers'] = '*'
  proxyRes.headers['Access-Control-Allow-Methods'] = 'GET, POST, PUT, OPTIONS'
}

const apiProxy = createProxyMiddleware({
  target: 'https://kaifa.baidu.com/',
  changeOrigin: true,
  pathRewrite: { '^/api/baidu': '/rest/v1/search' },
  secure: false,
  onProxyRes: restream,
})

module.exports = function (req, res) {
  apiProxy(req, res, (result) => {
    console.log('result:', result)
    if (result instanceof Error) {
      throw result
    }
    throw new Error(
      `Request '${req.url}' is not proxied! We should never reach here!`
    )
  })
}
```

ä¿®æ”¹å®Œæˆåç›´æ¥ git push å°±è¡Œã€‚ä»£ç æ¨ä»“åº“åä¼šï¼Œvercel ä¼šè‡ªåŠ¨æ‹‰å–æœ€æ–°ä»£ç æ›´æ–°åˆ°å®ƒçš„æœåŠ¡å™¨ï¼Œæˆ‘ä»¬åªè¦è°ƒç”¨ä¸€ä¸‹æ¥å£çœ‹æ˜¯å¦é€šå°±è¡Œã€‚
å…·ä½“çš„ä»£ç é€»è¾‘å¯çœ‹ github åœ°å€ï¼š[nextjs](https://github.com/kinyaying/nextjs)

## äºŒã€çŸ¥ä¹ä¸“æ ç›®å½• zhihu-helper

### **æˆå“å±•ç¤º**

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cafa039c4bbe4edaba88a76715bb38ac~tplv-k3u1fbpfcp-watermark.image)
å®‰è£…åœ°å€ï¼š

1. å®‰è£…[æ²¹çŒ´æ’ä»¶](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?hl=zh-CN) ï¼ˆå¦‚æœå®‰è£…è¿‡åˆ™ä¸ç”¨å†å®‰ï¼‰
2. å®‰è£… [zhihu-helper](https://greasyfork.org/zh-CN/scripts/421238-zhihu-helper)

ä»£ç åœ°å€ï¼š[wokoo/zhihu-helper](https://github.com/kinyaying/wokoo/tree/master/example/zhihu-helper)

### **å¼€å‘æ­¥éª¤**

#### 1.1 é¡¹ç›®å®‰è£… & åˆå§‹åŒ–é…ç½®

```js
npm i wokoo -g
wokoo zhihu-help
```

é€‰æ‹©æ¨¡æ¿

- [ ] vue
- [ ] react

è¿™é‡Œé€‰æ‹© reactï¼Œç­‰å¾…é¡¹ç›®å®‰è£…ã€‚é¡¹ç›®å®‰è£…å®Œæˆåï¼Œæ ¹æ®æç¤ºæ‰§è¡Œä¸‹å‘½ä»¤ï¼š

```shell
cd zhihu-helper
npm start
```

- æ‰“å¼€æ²¹çŒ´è„šæœ¬ç¼–è¾‘å™¨ï¼ŒæŠŠ tampermonkey.js çš„å†…å®¹å¤åˆ¶è¿›å»ã€‚

  ![tampermonkey](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0c9ead8b41c84e54b0d6bf056da19cc8~tplv-k3u1fbpfcp-zoom-1.image)

  ![copy-tampermonkey](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9037cc204ab434786c2b0e7ddde8541~tplv-k3u1fbpfcp-zoom-1.image)

- æ‰“å¼€ç½‘é¡µ[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/mandy)ï¼Œå³ä¸Šè§’å‡ºç°ä¸€åªçŒ´å­å›¾æ ‡ï¼Œè¯´æ˜é¡¹ç›®å·²è·‘é€šã€‚

**è¡¥å……è¯´æ˜**

æ­¤å¤„æœ‰çš„æµè§ˆå™¨ä¸ä¼šå‡ºç°çŒ´å­å›¾æ ‡ã€‚æ‰“å¼€æ§åˆ¶å°å¯è§æŠ¥é”™ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a1c6afc5b4cb4494b72c0d7b685f5579~tplv-k3u1fbpfcp-zoom-1.image)

å†çœ‹è¯·æ±‚çš„ html èµ„æºçš„å“åº”å¤´ï¼Œå¯ä»¥å‘ç°å¤šäº†ä¸€æ¡`content-security-policy`è§„åˆ™ã€‚ä¹Ÿå°±æ˜¯è¯´çŸ¥ä¹ä½¿ç”¨äº† csp å†…å®¹å®‰å…¨ç­–ç•¥ï¼Œé€šè¿‡`content-security-policy`ä¸­çš„`script-src`å­—æ®µå¯çŸ¥ï¼ŒçŸ¥ä¹åªå…è®¸åŠ è½½æŒ‡å®šåŸŸåçš„ jsã€‚å…·ä½“æƒ…å†µå¯é˜…è¯» ğŸ‘‰ [å†…å®¹å®‰å…¨ç­–ç•¥( CSP )](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a7ce3b03a5434e2aac0a911940d01a0d~tplv-k3u1fbpfcp-zoom-1.image)

**å¦‚ä½•ç»•è¿‡æ­¤å®‰å…¨ç­–ç•¥ï¼Œæ­¤å¤„ç»™ä¸¤ä¸ªæ–¹æ³•ï¼š**

1. å®‰è£…æ’ä»¶[Disable Content-Security-Policy](https://chrome.pictureknow.com/extension?id=5b80153e8db143afa59310bc0f282f1f), åœ¨è°ƒè¯•çŸ¥ä¹é¡µé¢æ—¶å¼€å¯æ’ä»¶ï¼Œè‡ªåŠ¨æŠŠ html é¡µé¢çš„`content-security-policy`ç»™è®¾ç½®ä¸ºç©ºã€‚
   æ³¨æ„ï¼Œå¼€å¯é¡µé¢åï¼Œè¦ç‚¹ä¸€ä¸‹æ’ä»¶ï¼ŒæŒ‰é’®å˜æˆå½©è‰²äº†æ‰ç®—å¼€å¯æˆåŠŸ
   ![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12886ea968314e57a5fdb99db26c4eb9~tplv-k3u1fbpfcp-watermark.image)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ba9ac0c0e6d14367bcd51b3aff3a9e2b~tplv-k3u1fbpfcp-zoom-1.image)

2. ä¼šé…ç½® charles çš„åŒå­¦ï¼Œå¯ä»¥è®¾ç½®ä¸€æ¡è½¬å‘è§„åˆ™

   ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e34719c066b147bbaabe2d19177a8bfe~tplv-k3u1fbpfcp-zoom-1.image)

   ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78488c8cc8d34cfa93453757f1e75d50~tplv-k3u1fbpfcp-zoom-1.image)

   ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/190b44584a6c449e84b6463022bafb41~tplv-k3u1fbpfcp-zoom-1.image)

è¿™ä¸¤ç§æ–¹æ³•é€‰ä¸€ç§å°±è¡Œã€‚

é‡åˆ°è¿™ä¸­ csp å†…å®¹å®‰å…¨ç­–ç•¥çš„ç½‘é¡µï¼Œåœ¨ä¸Šçº¿åˆ°æ²¹çŒ´å•†åº—çš„æ—¶å€™ä¸èƒ½ç”¨æ‰˜ç®¡ cdn çš„æ–¹å¼ï¼Œè¦å°†ä»£ç å¤åˆ¶åˆ°ç¼–è¾‘æ¡†ä¸­ã€‚

#### 1.2 å¼€å‘åŸºæœ¬åŠŸèƒ½

æ•´ç†æ€è·¯

1. ç»˜åˆ¶å·¦ä¾§æŠ½å±‰å¼¹çª—
2. å¼¹çª—å¼¹å‡ºæ—¶è¯·æ±‚çŸ¥ä¹åˆ—è¡¨æ¥å£ï¼Œæ‹¿åˆ°åˆ—è¡¨æ•°æ®
3. ä¸‹æ‹‰æ—¶å®ç°åŠ è½½æ›´å¤šçš„åŠŸèƒ½

ä¸‹é¢æˆ‘ä»¬æ¥é€æ­¥å®ç°å§~

**æ­¥éª¤ 1. ç»˜åˆ¶å·¦ä¾§æŠ½å±‰å¼¹çª—**

ä¸»è¦é€šè¿‡ this.state.show æ§åˆ¶å¼¹çª—çš„æ˜¾ç¤ºéšè—ã€‚æ­¤æ­¥éª¤æŒºç®€å•çš„ï¼Œå¯ä»¥ç›´æ¥çœ‹ä»£ç :[step1](https://github.com/kinyaying/wokoo/blob/master/example/zhihu-helper/src/step1.js)ï¼Œå¯ä»¥å°† index.js å…¥å£é‡Œçš„ app æ›¿æ¢æˆ step1 æŸ¥çœ‹æ•ˆæœã€‚

**æ­¥éª¤ 2. è¯·æ±‚[çŸ¥ä¹åˆ—è¡¨](https://www.zhihu.com/api/v4/columns)æ¥å£ï¼Œè·å–åˆ—è¡¨æ•°æ®**

- å®‰è£… axiosï¼Œå¹¶å¼•å…¥

```shell
npm install axios
```

- è®¡ç®—è¯·æ±‚å‚æ•°

åˆ†æè¯·æ±‚çš„ url å¯çŸ¥ï¼Œè¯·æ±‚æ¥å£ä¸ºï¼š

```js
;`https://www.zhihu.com/api/v4/columns${this.queryName}/items?limit=20&offset=${offset}`
```

å…¶ä¸­ this.queryName æ˜¯ä¸“æ åç§°ï¼Œå½“é¡µé¢ä¸º[ä¸“æ åˆ—è¡¨é¡µ](https://zhuanlan.zhihu.com/mandy)æ—¶å°±æ˜¯ pathname; å½“é¡µé¢ä¸º[ä¸“æ è¯¦æƒ…é¡µ](https://zhuanlan.zhihu.com/p/348005704)æ—¶ï¼Œéœ€è¦é€šè¿‡ç±»åä¸º`ColumnPageHeader-TitleColumn`çš„ a æ ‡ç­¾çš„ href æ¥è·å–ã€‚

![zhihu](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33e6ede0ef02494e9ecf138b5ab19c3b~tplv-k3u1fbpfcp-zoom-1.image)

![zhihu1](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec4215a91a3b4bb7a1666f06341c094d~tplv-k3u1fbpfcp-zoom-1.image)

é€šè¿‡è¿™ä¸¤å¼ å›¾åº”è¯¥æ›´å¥½ç†è§£ getQueryName æ–¹æ³•

```js
getQueryName = () => {
  let pathname = location.pathname
  let detailRegExp = /^\/p\/\d+/
  let queryName = ''
  // ä¸“æ è¯¦æƒ…é¡µ
  if (detailRegExp.test(pathname)) {
    let aTage = document.getElementsByClassName('ColumnPageHeader-TitleColumn')
    let url = aTage[0].href
    queryName = url.slice(url.lastIndexOf('/'))
  } else {
    // ä¸“æ åˆ—è¡¨é¡µ
    // http://zhuanlan.zhihuå’Œhttp://zhihu/columnä¸¤ç§æƒ…å†µéƒ½æ˜¯ä¸“æ 
    if (pathname.indexOf('/column') === 0) {
      pathname = pathname.slice('/column'.length)
    }
    queryName = pathname
  }
  this.queryName = queryName
}
```

è€Œåˆ—è¡¨é¡µåˆå­˜åœ¨ä¸¤ç§åŸŸåï¼šhttps://www.zhihu.com/column/mandy å’Œ https://zhuanlan.zhihu.com/mandy æ‰€ä»¥åœ¨`else`é€»è¾‘é‡Œé’ˆå¯¹`https://www.zhihu.com/column/mandy `åšäº†å¤„ç†ï¼Œåªä¿ç•™/mandy

é€šè¿‡ getQueryName æ–¹æ³•ï¼Œæˆ‘ä»¬è·å–åˆ°äº†è¯·æ±‚å‚æ•°

- å‘é€è¯·æ±‚ï¼Œæ‹‰å–ç›®å½•åˆ—è¡¨

```js
getList = async () => {
  if (!this.state.hasMore) return
  let { offset } = this.state
  let { data } = await axios.get(
    `https://www.zhihu.com/api/v4/columns${this.queryName}/items?limit=20&offset=${offset}`
  )
  let list = data.data.map((i) => ({
    title: i.title,
    url: i.url,
    id: i.id,
    commentCount: i.comment_count,
    voteupCount: i.voteup_count,
  }))
  if (data.paging.is_end) {
    this.setState({ hasMore: false })
  }
  offset += limit

  this.setState({
    list: [...this.state.list, ...list],
    offset,
  })
}
```

ç¬¬äºŒæ­¥çš„è¿‡ç¨‹å®ç°å®Œäº†ï¼Œä»£ç åœ¨è¿™é‡Œ ğŸ‘‰[step2](https://github.com/kinyaying/wokoo/blob/master/example/zhihu-helper/src/step2.js) ï¼Œå¯ä»¥å°† index.js å…¥å£é‡Œçš„ app æ›¿æ¢æˆ step2 æŸ¥çœ‹æ•ˆæœã€‚

è¿™æ—¶æ’ä»¶çš„æ•ˆæœæ˜¯è¿™æ ·çš„ï¼Œé™¤äº†æ²¡æœ‰ä¸‹æ‹‰åŠ è½½åŠŸèƒ½ï¼Œå…¶ä»–åŸºæœ¬å®Œå·¥äº†ã€‚

![image-20210206004837608](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3417e0182fd94ea5b4b15159b0f9768c~tplv-k3u1fbpfcp-zoom-1.image)

**æ­¥éª¤ 3. ä¸‹æ‹‰æ—¶å®ç°åŠ è½½æ›´å¤šçš„åŠŸèƒ½**

æ— é™æ»šåŠ¨çš„ç»„ä»¶å¼•äº†ç¬¬ä¸‰æ–¹åº“[react-infinite-scroll-component](https://www.npmjs.com/package/react-infinite-scroll-component)ï¼š

```shell
npm install react-infinite-scroll-component
```

ä¸»è¦æ˜¯åœ¨ render å‡½æ•°é‡Œå¢åŠ  InfiniteScroll ç»„ä»¶ï¼Œæ³¨æ„ InfiniteScroll çš„ height éœ€è¦é€šè¿‡è®¡ç®—ç»™ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œå¦åˆ™æ— æ³•è§¦å‘æ»šåŠ¨ã€‚

```js
<ul className="list-ul" onMouseLeave={this.handleMouseLeave}>
  <InfiniteScroll
    dataLength={list.length}
    next={this.handleInfiniteOnLoad}
    hasMore={hasMore}
    loader={<h4>Loading...</h4>}
    height={document.documentElement.clientHeight - 53}
    endMessage={
      <p style={{ textAlign: 'center' }}>
        <b>åˆ°åº•äº†ï¼Œæ²¡å†…å®¹å•¦~</b>
      </p>
    }
  >
    {list.map((i) => (
      <li className="list-li" key={i.id}>
        ...
      </li>
    ))}
  </InfiniteScroll>
</ul>
```

æ­¤æ—¶åŠŸèƒ½å·²ç»å¼€å‘å®Œæˆï¼Œå…·ä½“ä»£ç æŸ¥çœ‹ ğŸ‘‰[app.js](https://github.com/kinyaying/wokoo/blob/master/example/zhihu-helper/src/app.js)

### éƒ¨ç½²æ’ä»¶åˆ°æ²¹çŒ´å•†åº—

**3.1 æ„å»º**

æ‰§è¡Œå‘½ä»¤

```shell
npm run build
```

**3.2 ç¡®è®¤æ²¹çŒ´è„šæœ¬æ–‡ä»¶ tampermonkey.js**

æ­¤æ–‡ä»¶ä¸­è¢«æ³¨é‡Šæ‰çš„//@xxx éƒ½æœ‰å«ä¹‰ï¼Œå¯ä»¥å¯¹åº”ç€ [tampermonkey å¼€å‘æ–‡æ¡£ ](https://www.tampermonkey.net/documentation.php?version=4.6&ext=dhdg) ç†è§£ã€‚

- @description æ’ä»¶æè¿°

- @match æŒ‡å®šæŸäº›åŸŸåä¸‹å¼€å¯æ­¤æ’ä»¶ï¼Œé»˜è®¤é…äº†ä¸¤æ¡ï¼Œ`// @match https://*/*`å’Œ`// @match https://*/*`è¡¨ç¤ºåœ¨æ‰€æœ‰åŸŸåä¸‹éƒ½å¼€å¯ã€‚ä½†æ˜¯æ­¤å¤„å¸Œæœ›åªåœ¨ zhihu ä¸“æ é‡Œä½¿ç”¨æ­¤æ’ä»¶ï¼Œæ‰€ä»¥è¦ä¿®æ”¹@math å­—æ®µã€‚

  ```js
  // @match        https://zhuanlan.zhihu.com/*
  // @match        https://www.zhihu.com/column/*
  ```

- @require æ²¹çŒ´è„šæœ¬å†…éƒ¨å¸®å¿™å¼•å…¥ç¬¬ä¸‰æ–¹èµ„æºï¼Œæ¯”å¦‚ jqueryï¼Œreact ç­‰ã€‚

  ```js
  // @require https://unpkg.com/react@17/umd/react.production.min.js
  // @require https://unpkg.com/react-dom@17/umd/react-dom.production.min.js
  ```

**3.3 å‘å¸ƒæ’ä»¶åˆ°æ²¹çŒ´å¸‚åœº**

å‘å¸ƒæ²¹çŒ´å¸‚åœºçš„ä¼˜ç‚¹æ˜¯ä¸ç”¨å®¡æ ¸ï¼Œå³å‘å³ç”¨ï¼Œéå¸¸æ–¹ä¾¿ã€‚

1. å°†/dist/app.bundle.js æ–‡ä»¶éƒ¨ç½²åˆ° cdn ä¸Šï¼Œè·å–åˆ°å¯¹åº” urlã€‚

**æ³¨æ„ï¼š**

- js æ–‡ä»¶å¯æ”¾åˆ° github ä¸Šï¼Œå¦‚æœæ‰˜ç®¡åˆ° github ä¸Šæœ€å¥½åš cdn åŠ é€Ÿï¼ˆæˆ‘ä½¿ç”¨ cdn.jsdelivr.net è¿›è¡Œ cdn åŠ é€Ÿï¼‰ã€‚

- å¦‚æœæ²¡æœ‰ cdn æœåŠ¡å™¨å¯è·³è¿‡æ­¤æ­¥éª¤ï¼Œåœ¨æ­¥éª¤ 4 ç›´æ¥å°† app.bundle.js å¤åˆ¶åˆ°æ²¹çŒ´è„šæœ¬ç¼–è¾‘å™¨ä¸­

2. ç™»å½•[æ²¹çŒ´å¸‚åœº](https://greasyfork.org/)ï¼Œè°·æ­Œè´¦å·æˆ– github è´¦å·éƒ½å¯ä½¿ç”¨ã€‚

3. ç‚¹å‡»è´¦å·åç§°ï¼Œå†ç‚¹å‡»ã€Œå‘å¸ƒä½ ç¼–å†™çš„è„šæœ¬ã€

   ![wokoo-tamp3](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dd3a083d7d9246aaaeddbe3bf1806698~tplv-k3u1fbpfcp-zoom-1.image)

   ![wokoo-tamp4](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1706095c2793482bbd4e822ff9b0ed5d~tplv-k3u1fbpfcp-zoom-1.image)

4. è¿›å…¥ç¼–è¾‘é¡µï¼Œå°† tampermonkey.js é‡Œçš„å†…å®¹å¤åˆ¶åˆ°ç¼–è¾‘æ¡†ä¸­

   æ³¨æ„ï¼š

   - æ­¥éª¤ 1 ä¸­å¦‚æœæ‰˜ç®¡äº† cdnï¼Œéœ€è¦å°†ä»£ç ä¸­çš„`localhost:8080`ç½‘å€æ›¿æ¢æˆé™æ€èµ„æº url

   - æ­¥éª¤ 1 ä¸­æ²¡æœ‰æ‰˜ç®¡ cdnï¼Œä¸èƒ½ç›´æ¥å°†/dist/app.bundle.js æ–‡ä»¶é‡Œçš„å†…å®¹å¤åˆ¶ç¼–è¾‘æ¡†ã€‚å› ä¸ºç¼–è¾‘æ¡†å†…ä»£ç æœ‰æœ€å¤§é™åˆ¶ï¼Œæˆ‘ä»¬æ„å»ºçš„ app.bundle.js æŠŠ react ç­‰ä¸‰æ–¹åº“æ„å»ºè¿›å»è¶…è¿‡æœ€å¤§é™åˆ¶äº†ã€‚

     éœ€è¦å¯¹æ„å»ºç»“æœè¿›è¡Œæ‹†åŒ…

     4.1 ä¿®æ”¹ tampermonkey.js ï¼Œé€šè¿‡@require æ–¹å¼å¼•å…¥ react å’Œ react-dom

     ```js
     // ==UserScript==
     // @name         zhihu-helper
     // @namespace    http://tampermonkey.net/
     // @version      0.0.1
     // @description  çŸ¥ä¹ç›®å½•
     // @author       xx
     // @match        https://zhuanlan.zhihu.com/*
     // @match        https://www.zhihu.com/column/*
     // @require https://unpkg.com/react@17/umd/react.production.min.js
     // @require https://unpkg.com/react-dom@17/umd/react-dom.production.min.js

     // ==/UserScript==

     // app.bundle.jsæ„å»ºå¥½çš„ä»£ç 
     ```

     4.2 ä¿®æ”¹ webpack.config.base.js çš„ entry å­—æ®µ

     ```js
     entry: {
         app: '/src/index.js',
         vendor: [
           // å°†reactå’Œreact-domè¿™äº›å•ç‹¬æ‰“åŒ…å‡ºæ¥ï¼Œå‡å°æ‰“åŒ…æ–‡ä»¶ä½“ç§¯
           'react',
           'react-dom',
         ],
       },
     ```

     4.3 é‡æ–°æ‰§è¡Œ`npm run build` æ„å»ºå‡ºæ–°çš„ app.bundle.jsï¼Œå¤åˆ¶åˆ°æ²¹çŒ´å¸‚åœºçš„ç¼–è¾‘æ¡†å†…ã€‚

     ![zhihu-tampermonkey](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5e2da6218f824bc7917a43b107362899~tplv-k3u1fbpfcp-zoom-1.image)

5. ç‚¹å‡» ã€Œå‘å¸ƒè„šæœ¬ã€å³å¯

# wokoo è„šæ‰‹æ¶çš„æ­å»º

æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥é˜…è¯» [wokoo è„šæ‰‹æ¶ï¼ˆæ­å»ºç¯‡ï¼‰](<https://gitee.com/zhufengpeixun/browser-plugin/blob/master/wokoo%E8%84%9A%E6%89%8B%E6%9E%B6(%E6%90%AD%E5%BB%BA%E7%AF%87).md>)
